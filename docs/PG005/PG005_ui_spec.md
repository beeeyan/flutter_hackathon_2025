# 画面仕様書: PG005 (Fix Rev.2)

## 画面メタ

| カラム名   | 内容           |
| ---------- | -------------- |
| 画面 ID    | PG005          |
| 画面名     | 投票メイン画面 |
| 画面物理名 | voting_page    |

## UI 要素一覧（必須）

| 要素 ID | 要素名               | 種別          | 文言キー/アイコン                             | 初期状態（表示/活性/選択） | 表示/活性条件                             |
| ------- | -------------------- | ------------- | --------------------------------------------- | -------------------------- | ----------------------------------------- |
| E01     | 残り時間タイマー     | Label         | 00:00                                         | 表示                       | 画面上部中央 (Overlay)                    |
| E02     | 残り持ち点カウンター | Label         | 残り {n} 回                                   | 表示                       | 画面上部右 (Overlay)                      |
| E03     | 物理演算ワールド     | GameWidget    | (Flame/Forge2D)                               | 表示                       | 画面全体（最背面）                        |
| E04     | 参加者ボール         | BodyComponent | アバター画像                                  | 表示                       | World 内オブジェクト (開始時に上から落下) |
| E05     | タップエフェクト     | Particle      | (ハートや波紋)                                | 非表示                     | E04 タップ時に発生                        |
| E06     | 終了オーバーレイ     | Container     | (半透明の黒背景)                              | 非表示                     | タイマー 0 秒時に表示 (タップ無効化用)    |
| E07     | 終了ラベル           | Label         | TIME UP!                                      | 非表示                     | E06 内に表示                              |
| E08     | 結果へ進むボタン     | Button        | 結果を見る                                    | 非表示                     | タイマー 0 秒 AND **Host である**         |
| E09     | 待機メッセージ       | Label         | ホストが結果を表示するのを<br>待っています... | 非表示                     | タイマー 0 秒 AND **Guest である**        |

## アクション一覧（必須）

| アクション ID | トリガー（操作）    | 対象要素 | 前提/ガード         | 実行内容（状態変更/副作用）                                                                                                                                                  | 遷移先 |
| ------------- | ------------------- | -------- | ------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------ |
| A01           | 画面初期化          | システム | -                   | 1. 物理世界を生成し、他参加者(E04)をスポーン<br>2. `sessions/{sessionId}` のステータス監視を開始<br>3. `members/{myUid}` の被投票監視を開始<br>4. タイマーカウントダウン開始 | -      |
| A02           | E04 (参加者) タップ | システム | 残り持ち点 > 0      | 1. 持ち点を減算(E02 更新)<br>2. E05(エフェクト)を表示<br>3. 対象ボールに衝撃(Impulse)を与え、送信キューに積む                                                                | -      |
| A03           | 送信キュー処理      | システム | 20 回毎 or 1 秒経過 | 1. Firestore `members/{targetUid}` の `bySender.{myUid}` をインクリメント更新                                                                                                | -      |
| A04           | 自データ更新検知    | E04      | リアルタイム同期    | 1. 自分への投票数に応じて、該当する E04(送信者)のサイズを拡大<br>2. 物理演算による位置自動調整                                                                               | -      |
| A05           | タイマー 0 秒到達   | システム | -                   | 1. E06(オーバーレイ)を表示し、物理ワールドへのタッチを遮断<br>2. 権限に応じて E08(Host)または E09(Guest)を表示                                                               | -      |
| A06           | E08 (結果) 押下     | システム | Host のみ           | 1. Firestore `sessions/{sessionId}` の `status` を `result` に更新                                                                                                           | -      |
| A07           | ステータス変更検知  | システム | -                   | 1. セッションの `status` が `result` になったことを検知<br>2. 全員一斉に画面遷移                                                                                             | PG006  |
