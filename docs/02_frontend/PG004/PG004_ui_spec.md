# 画面仕様書: PG004

## 画面メタ

| カラム名   | 内容                   |
| ---------- | ---------------------- |
| 画面 ID    | PG004                  |
| 画面名     | ルーム待機室（ロビー） |
| 画面物理名 | room_lobby_page        |

## UI 要素一覧（必須）

| 要素 ID | 要素名             | 種別           | 文言キー/アイコン                       | 初期状態（表示/活性/選択） | 表示/活性条件    |
| ------- | ------------------ | -------------- | --------------------------------------- | -------------------------- | ---------------- |
| E01     | ヘッダータイトル   | Label          | 待機中...                               | 表示                       | -                |
| E02     | 退出ボタン         | Button/Icon    | ドアアイコン (Exit)                     | 表示                       | -                |
| E03     | QR コード画像      | Image          | (ルーム ID の QR)                       | 表示                       | -                |
| E04     | ルーム ID ラベル   | Label          | ID: {roomId}                            | 表示                       | -                |
| E05     | ID コピーボタン    | Button/Icon    | Copy                                    | 表示                       | -                |
| E06     | 参加人数カウンター | Label          | 参加者 ({n}人)                          | 表示                       | -                |
| E07     | 参加者リスト       | List           | -                                       | 表示                       | -                |
| E08     | 参加者アバター     | Image          | (各ユーザーの画像)                      | 表示                       | リストアイテム内 |
| E09     | 参加者名           | Label          | (各ユーザーの名前)                      | 表示                       | リストアイテム内 |
| E10     | 参加者 Bio         | Label          | (各ユーザーの Bio)                      | 表示                       | リストアイテム内 |
| E11     | 自分バッジ         | Label/Icon     | YOU                                     | 表示                       | 自分の行のみ表示 |
| E12     | スタートボタン     | Button         | 投票をスタートする！                    | 表示/活性（ホストのみ）    | isHost = true    |
| E13     | 待機メッセージ     | Label/Progress | ホストが開始するのを<br>待っています... | 表示（ゲストのみ）         | isHost = false   |

## アクション一覧（必須）

| アクション ID | トリガー（操作）   | 対象要素 | 前提/ガード | 実行内容（状態変更/副作用）                                                                                                                  | 遷移先 |
| ------------- | ------------------ | -------- | ----------- | -------------------------------------------------------------------------------------------------------------------------------------------- | ------ |
| A01           | 画面初期化         | システム | -           | 1. Firestore `rooms/{roomId}` を購読開始<br>2. メンバー増減を検知し E06, E07 を更新<br>3. ルームステータスが `playing` になったら A04 を実行 | -      |
| A02           | E02 (退出) 押下    | システム | -           | 1. 確認ダイアログ表示（任意）<br>2. Firestore `rooms/{roomId}/members` から自分を削除<br>3. 画面遷移                                         | PG002  |
| A03           | E05 (Copy) 押下    | システム | -           | 1. ルーム ID をクリップボードにコピー<br>2. トースト等で「コピーしました」を表示                                                             | -      |
| A04           | E12 (開始) 押下    | システム | ホストのみ  | 1. Firestore `rooms/{roomId}` の `status` を `playing` に更新<br>2. `startTime` (現在時刻) / `endTime` (現在+制限時間) を設定                | -      |
| A05           | ステータス変更検知 | システム | -           | 1. ルームのステータスが `playing` になったことを検知<br>2. 全員一斉に画面遷移                                                                | PG005  |
